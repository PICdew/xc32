2006-06-07  Maciej W. Rozycki  <macro@mips.com>

	[mti-gdb-bug411]
	* generic/gdbtk-interp.c (gdbtk_interpreter_resume): Also
	initialize gdb_stdtargerr.

2006-05-18  Maciej W. Rozycki  <macro@mips.com>

	[mti-trivial]
	* library/globalpref.itb (GlobalPref::_build_win): Remove a
	full stop for consistency.

2006-05-18  Maciej W. Rozycki  <macro@mips.com>

	[mti-gdb-bug311]
	* library/globalpref.itb (GlobalPref::_init): Remove.
	(GlobalPref::constructor): Remove a call to _init.
	(GlobalPref::_build_win): Simplify handling of the tracing
	setting.
	(GlobalPref::_toggle_tracing): Remove.

2006-05-16  Nigel Stephens  <nigel@mips.com>

	[mti-insight-bug220]
	* library/interface.tcl (gdbtk_tcl_file_changed): Call
	gdbtk_locate_main to flush the "main" cache when the exec
	file is closed.
	(gdbtk_clear_file): Similarly.

2005-11-11  Maciej W. Rozycki  <macro@mips.com>

	[mti-trivial]
	* library/interface.tcl (gdbtk_update_safe): Fix a typo.

2005-09-26  Nigel Stephens  <nigel@mips.com>

	[mti-insight-ipcdisable]
	* library/prefs.tcl (gdb/ipc/enabled): Set default value to 0,
	since the behaviour when enabled is "surprising".

2005-09-21  Nigel Stephens  <nigel@mips.com>
	
	[mti-gdb-ksegoverlay]
	* generic/gdbtk-cmds.c (gdb_search): Only check the block type
	when there is a full debug record.
	(gdb_disassemble_driver): Use find_pc_overlay() to find the
	section containing the low and high addresses, and then
	find_pc_sect_line() instead of find_pc_symtab() to get the debug
	data. If addresses are in the unmapped overlay range, then convert
	to the mapped range. Also use find_pc_sect_line() instead of
	find_pc_line() to get line table. Convert back to original
	unmapped address when outputting the disassembly.
	(pc_function_name): Use find_pc_overlay()/find_pc_sect_function()
	to handle cases where pc is in an unmapped overlay. Convert pc to
	mapped address.
	
2005-09-19  Nigel Stephens  <nigel@mips.com>

	[mti-bugzilla-224]
	* library/interface.tcl (gdbtk_update_safe): Don't prevent updates
	if $gdb_running is set - that just means we're connected to the
	target. Instead require $gdbtk_state(busyCount) to be zero - it is
	non-zero when gdb is executing a command or waiting for the
	target.

	[mti-insight-regwin]
	* generic/gdbtk-register.c (get_register): If frame_register()
	returns a negative value for optim, then make displayed register
	value a null string instead of "Optimized Out".

	* library/regwin.itb (_build_win): Add "-anchor e" to the value
	tags, so that the register values are right-aligned in their cell
	instead of centred, to make it easier to compare values in
	neighbouring cells.
	(reconfig): Similarly when reconfiguring the window.
	
2005-09-19  Nigel Stephens  <nigel@mips.com>

	[mti-insight-memwin]
	* generic/gdbtk-cmds.c (gdb_CA_to_TAS): Use
	core_addr_to_string_nz() rather than paddr_nz, to prepend the
	initial "0x" which is required by the Tcl address parsing code, in
	memwin.itb.

	* library/memwin.itb (build_win): Don't use gdb_CA_to_TAS to
	process current address, since that removed the symbolic form of
	the address.
	(incr_addr): Similarly.
	(goto): Similarly.
	(init_addr_exp): Use gdb_CA_to_TAS here to set default address at
	start of .data section, which ensures that the address is properly
	formatted for incr_addr et al with a leading "0x".

2004-11-04  Chris Dearman  <chris@mips.com>

	* gdb.rc: Include TK resources when built staticly.

2004-10-06  Chris Dearman  <chris@mips.com>

	* library/console.itb: Only insert prompt if one has been set.
	(activate): Always update prompt.

	* library/interface.tcl (gdb_run_readline_command_no_output):
	Reset readlineShowUser to after running running command.
	(gdbtk_tcl_readline_begin): Create console window if one doesn't
	exist and input is required.
	(gdbtk_tcl_readline_end): Restore prompt.
	(gdbtk_stop): terminate and pending readline request.

2004-09-27  Chris Dearman  <chris@mips.com>

	* generic/gdbtk-stack.c (get_frame_name): Removed spurious
	newlines from dummy/sigtramp frame names.

	* generic/gdbtk-cmds.c (gdb_load_disassembly): breakpoint tags are
	now set in gdbtk_load_asm.
	(gdbtk_load_asm): Don't enable breakpoint tags for addresses which
	will get moved (ie branch delay slots)

2004-09-21  Chris Dearman  <chris@mips.com>

	* library/console.itb(invoke): Take a copy of the command text
	before passing it to gdb_immediate.  GDB modifies the command line
	as it parses it and this prevents the moodified line ending up in
	the history.

2004-09-20  Chris Dearman  <chris@mips.com>

	* generic/gdbtk-stack.c (gdb_get_blocks): Use
	core_addr_to_string_nz instead of paddr_nz
	(gdb_get_blocks): Use core_addr_to_string_nz instead of paddr_nz
	when generating block addresses so that they don't get truncated.
	(gdb_selected_block): Ditto.
	(gdb_selected_frame): Ditto.

	* generic/gdbtk-cmds.c (gdb_update_mem): Use paddr_nz when
	generating address labels to get appropriate display for 32/64 bit
	targets

	* library/images2/sdemips.gif (Repository): New image for "MIPS SDE"

	* library/targetselection.ith: Variables & Functions for MDI and
	flow-control support

	* library/targetselection.itb(init_target_db): Comment
	typo. Changed GNU simulator target name to "GNU Simulator". Added
	230400 as possible baudrate to various targets. Added MDI target. 
	(_init_prefs): Added MDI & flow-control preferences.
	(_init_target): Added MDI * flow-control preferences.
	(build_win): Added support for MDI targets and hardware
	flow-control. Fixed typo in User-Specified Breakpoints balloon help.
	(chage_baud): Force radix to decimal when setting baud rate.
	(change_mdidev): MDI support.
	(change_flow): flow-control support.
	(get_mdidev_list): MDI support.
	(cancel): Force radix to decimal when restoring baud rate. Restore
	previous flow-control state.
	(valid_target): Don't treat a target just called "tcp" as a
	special case.

	* library/srctextwin.itb(config_win): Added FS2 & MDI cycle count
	keys.
	(FillMixed): Only replace pane if it has changed name.
	(do_source_popup): Added "Dump Memory at &var" menu entry.
	(do_key): Added FS2 & MDI cycle count keyhandler support.

	* library/srcbar.itcl (SrcBar): Comment typo.
	(create_view_menu): Added entries for FS2 console and MDI cycle
	counter.
	(create_buttons): Added MDI cycle counter button.
	(_set_mdi): New function to set state of FS2 & MDI menus & buttons.
	(enable_ui): Call _set_mdi
	(do_connect): Reset FS2/MDI cycle counter status so that they
	will be detected when _set_mdi is next called.
	(_mdinocount & _mdifs2): New private common variables controlling
	MDI/FS2 menus/buttons.

	* library/regwin.itb(_layout_table): Disable all unused register
	slots.
	(update): Comment typo.

	* library/prefs.tcl (pref_read): Make sure file_opened is always
	initialised to avoid warning in debug window.

	* library/memwin.ith: Added wheel_addr function

	* library/memwin.itb(build_win): Support mousewheel scrolling.
	Use gdb_CA_to_CAS to format address.
	(edit): Need to update widget from the base address when entering
	a string because of the way gdb_update_mem calculates
	indices. gdb_update_mem should really take an offset...
	Replace trimleft/trimright with trim.
	(_update_address): Replace trimleft/trimright with trim.
	(incr_addr): Use gdb_CA_to_CAS to format address.
	(wheel_addr): New function to support mousewheel scrolling
	(reconfig): Replace trimleft/trimright with trim.
	(do_popup): Only display "Go To" & "Open New Window" menu entries
	if there is a valid address.
	(goto): Use gdb_CA_to_TAS to format address.
	(init_addr_exp): Cope with 64bit addresses when examing section
	addresses. Use "%#08lx" format when setting up initial address.

	* library/main.tcl: Append each candidate directory from
	INSIGHT_PLUGINS environment variable to the gdb_plugins/auto_path
	variables individually.

	* library/interface.tcl (set_target_name): Added MDI support.
	(gdbtk_attach_remote): Clear gdb_target_name and return
	ATTACH_CANCELLED if there are two failures in a row, otherwise
	there is no escape...

	* library/helpviewer.tcl (open_help): If HTML viewer is netscape
	or mozilla try using "-remote openURL()" call starting a new
	browser.  This may need tweaking for Windows.

	* library/download.itb(constructor): feedback widget doesn;t
	support -fraction. Display section sizes as int not float.
	(update_download): Use feedback reset/step calls to set completion
	status. This is a bit tacky as they both update the display
	causing the meters to flash.
	(done): Same.
	(download_it): Loof for a ".relf" file if target is mdi so that
	display shows the same sections as gdb actually downloads.

	* library/debugwin.itb(build_win): Blue text on black doesn't
	work, so use yellow when displaying arguments in trace.

	* library/about.tcl: Change image & text to refer to MIPS

2004-04-16  David Ung  <davidu@mips.com>

	* generic/gdbtk-hooks.c: Add const also to gdbtk_pre_add_symbol
	prototype. 

-------------------------------------------------------------------------
	
2004-08-27  Martin Hunt  <hunt@redhat.com>

	* library/ipc.tcl: New file.
	* library/ipcpref.ith: New file.
	* library/ipcpref.itb: New file.

	* library/srcwin.itb (SrcWin::inferior): Call ipc
	send if enabled.
	
	* library/prefs.tcl (pref_set_defaults): Enable color
	schemes by default. Add IPC defaults.
	
	* library/srcbar.itcl (create_pref_menu): Create
	"Advanced" cascade menu and put "Edit Color Schemes"
	and "IPC Support" under it.

	* library/managedwin.itb (ManagedWin::destructor): 
	If IPC enabled then send "quit" on exit.
	
	* library/main.tcl: Start IPC if enabled.

	* library/prefs.tcl (pref_set_defaults): Add IPC defaults.

	* library/gdbmenubar.itcl (menubar_get_current_menu): 
	New method.

2004-08-09  Ben Elliston  <bje@au.ibm.com>

	* generic/gdbtk-register.c (get_register_size): Use
	register_size() instead of DEPRECATED_REGISTER_RAW_SIZE.
	(get_register): Likewise.
	(register_changed_p): Likewise.

2004-07-02  Martin Hunt  <hunt@redhat.com>

	* library/targetselection.itb: Use /dev/comX for
	cygwin instead of just comX.

	* library/interface.tcl (gdbtk_tcl_preloop): Set baud rate.

2004-07-02  Martin Hunt  <hunt@redhat.com>
	
	* generic/gdbtk-cmds.c (symtab_to_filename): New function. Like
	symtab_to_fullname() but returns the filename if the fullname 
	cannot be found.
	
	* generic/gdbtk-cmds.c (gdb_find_file_command): Revert
	patch of 2004-06-11. Use symtab_to_filename() again.
	(gdb_loc): Ditto.
	(gdb_loadfile): Ditto.
	* generic/gdbtk-bp.c (gdb_get_breakpoint_info): Ditto.
	(gdb_get_tracepoint_info): Ditto.

	* generic/gdbtk-cmds.h: Declare symtab_to_filename().

2004-06-26  Andrew Cagney  <cagney@gnu.org>

	* generic/gdbtk-hooks.c (gdbtk_add_hooks): Call
	deprecated_set_gdb_event_hooks.

2004-06-25  Andrew Cagney  <cagney@gnu.org>

	* generic/gdbtk.h: "ui_loop_hook" was deprecated, update.
	* generic/gdbtk-hooks.c (gdbtk_add_hooks, x_event): Ditto.
	* generic/gdbtk-cmds.c: Ditto.

2004-06-24  Andrew Cagney  <cagney@gnu.org>

	* generic/gdbtk-hooks.c (gdbtk_add_hooks): Update references to
	pre_add_symbol_hook and post_add_symbol_hook, both deprecated.
	* library/interface.tcl (gdbtk_memory_changed): Update comments.
	
2004-06-24  Andrew Cagney  <cagney@gnu.org>

	* generic/gdbtk-hooks.c (ui_loop_hook, pre_add_symbol_hook)
	(post_add_symbol_hook, selected_frame_level_changed_hook): Delete
	extern declarations.

2004-06-15  Alan Modra  <amodra@bigpond.net.au>

	* generic/gdbtk-cmds.c (gdb_load_info): Use bfd_get_section_size
	instead of bfd_get_section_size_before_reloc.

2004-06-11  Martin Hunt  <hunt@redhat.com>

	* generic/gdbtk-cmds.c (gdb_find_file_command): Use
	symtab_to_fullname() instead of symtab_to_filename().
	(gdb_loc): Ditto.
	(gdb_loadfile): Ditto.
	* generic/gdbtk-bp.c (gdb_get_breakpoint_info): Ditto.
	(gdb_get_tracepoint_info): Ditto.	

	* generic/gdbtk-register.c (get_register): Simplify and remove
	references to DEPRECATED_REGISTER_CONVERT_TO_VIRTUAL.

2004-05-27  Martin Hunt  <hunt@redhat.com>

	* library/tdump.tcl (build_win): Remove old nonworking
	code to select scrolledtext mode.  Just use "dynamic".

2004-04-22  Keith Seitz  <kseitz@sources.redhat.com>

	* generic/gdbtk-hooks.c (gdbtk_add_hooks): "Update" deprecated hooks.
	"Houston... We have a problem."
	* generic/gdbtk-interp.c (gdbtk_interpreter_resume): Likewise.
 	* generic/gdbtk.c (gdbtk_init_1): Likewise.
	
2004-04-19  Roland McGrath  <roland@redhat.com>

	* generic/gdbtk-hooks.c: Update gdbtk_pre_add_symbol forward decl to
	match defn type change.

2004-04-15  Roland McGrath  <roland@redhat.com>

	* generic/gdbtk-hooks.c (gdbtk_pre_add_symbol): Add const to arg type.
	(pre_add_symbol): Likewise in extern decl.

2004-04-05  Martin Hunt  <hunt@redhat.com>

	* library/session.tcl: Make hostname and portname
	session-dependent. Add gdb_bg_num (the color
	scheme number) as a per-session variable.

	* library/prefs.tcl (pref_read): If color schemes are in use,
	set colors based on the current scheme.
	(pref_save): Add "bg" section.
	(pref_set_defaults): Define new variable gdb/use_color_schemes
	and define 16 default background colors.

	* library/managedwin.itb (ManagedWin::window_name): Append
	window "instance" string to window name.
	(ManagedWin::window_instance): Set window instance string.

	* library/debugwin.itb: Add a reconfig method to restore
	unique black textbackground, overriding color scheme.

	* library/csprefs.itb:
	* library/csprefs.ith: New files. Implement color scheme
	preferences.

	* library/util.tcl (set_bg_colors): New function.
	(r_setcolors): New function.

	* library/regwin.itb (_prefs_changed): Deleted.
	(reconfig): New function.  Updates tkTable color tags
	if color scheme changes.
	* library/regwin.ith: Update to reflect above changes.

	* library/srcbar.itcl (create_pref_menu): Add pulldown
	menus for "Edit Color Schemes..." and "Use Color Schemes".
	(reconfig): Fix up menu items for color schemes.

	* library/globalpref.itb (_init_var): Add
	gdb/use_color_schemes to variable list.
	(_build_win): Add a checkbutton to enable/disable
	color schemes.

	* library/gdbmenubar.itcl (menubar_add_cascade): Add a class
	argument so cascade menus can be managed by class too.

	* library/interface.tcl (gdbtk_tcl_fputs): Check for
	existence of gdbtk_state(console).  Stops annoying error
	messages.
	(gdbtk_tcl_fputs_error): Ditto.
	(gdbtk_tcl_fputs_log): Ditto.

2004-03-29  Martin Hunt  <hunt@redhat.com>

	* generic/gdbtk-register.c (map_arg_registers): If a specific
	register was requested, just return it without validating it
	has a name.
	(get_register): Check DEPRECATED_REGISTER_CONVERTIBLE_P ().

2004-02-17  Martin Hunt  <hunt@redhat.com>

	* generic/gdbtk-register.c (Gdbtk_Register_Init): Replace
	calls to register_gdbarch_swap with deprecated_register_gdbarch_swap.

	* library/srcwin.itb: Remove an apparently redundant call
	to gdbtk_locate_main and location. This actually broke in
	situations where no source files were found.
